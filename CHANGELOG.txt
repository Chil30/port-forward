================================================================================
                        端口转发管理工具 更新日志
================================================================================

<<<<<<< HEAD
版本 1.0.3 (2026-01-15)
--------------------------------------------------------------------------------
新增功能:
  - 导入/导出配置功能：
    * 导出当前所有转发规则到 JSON 文件
    * 支持从备份文件导入规则
    * 导入时可选择使用 nftables/iptables/realm 方案
    * 自动收集 nftables、iptables、realm、gost、haproxy 配置
  - 开机自启自动设置：
    * 配置转发时自动创建开机恢复服务
    * nftables/iptables 规则重启后自动恢复
    * 无需手动设置，配置即生效

改进:
  - 界面优化：头部分隔线长度缩短，更紧凑
  - 启动转发服务（选项4）逻辑优化：
    * 改进配置检测，不再仅依赖 systemctl is-enabled
    * 检查配置文件存在即可启动，无需预先启用服务
    * 显示已运行的服务状态
    * 启动失败时显示错误日志
    * 支持从 netfilter-persistent 恢复 iptables 规则

修复:
  - 修复重启 VPS 后转发规则丢失的问题
  - 修复选项4启动转发服务时无法启动的问题
  - 修复卸载所有服务时未清理 nftables 规则的问题
  - 修复配置存在但无法被检测到的问题

--------------------------------------------------------------------------------

版本 1.0.2 (2026-01-13)
--------------------------------------------------------------------------------
新增功能:
=======
版本 1.0.4 (2026-01-19)
--------------------------------------------------------------------------------
新增功能:
  - CLI 模式完整支持：
    * 一键配置端口转发：pof -m nft 3389:1.2.3.4:3389
    * 支持批量规则配置（逗号分隔）
    * 支持协议选择：--tcp / --udp / --both
    * 支持静默模式：-q, --quiet（适合脚本）
    * 支持删除规则：-d, --delete
    * 支持列出规则：-l, --list
    * 自动设置开机自启
    * 方案简写支持：iptables/ipt, nftables/nft, haproxy/hap
    * 适合批量脚本、远程SSH执行、ansible/terraform集成
  - 多IP故障转移支持：
    * 配置转发时支持输入多个落地IP（逗号分隔）
    * HAProxy 支持多IP故障转移（主备模式）
    * gost 支持多IP故障转移（自动生成多节点配置）
    * realm 支持多IP故障转移
    * nginx stream 支持多IP故障转移
    * 方案选择界面显示 [故障转移] 标识
  - 导入导出功能增强：
    * 新增"生成一键导入命令"功能，方便跨机器迁移
    * 新增"从URL导入"功能，直接从网络下载配置
    * 新增"粘贴JSON内容导入"功能
    * 导出时显示详细的跨机器迁移方法（SCP、base64）
    * 导出时可选择导出方式（文件/命令/JSON显示）
  - 命令行参数支持：
    * -m, --method <方案> [选项] <规则>  快速转发模式
    * -d, --delete <方案> <端口>         删除规则
    * -l, --list                         列出当前规则
    * --import-nft <file>                使用 nftables 导入配置
    * --import-ipt <file>                使用 iptables 导入配置
    * --version, -v                      显示版本信息
    * --help, -h                         显示帮助信息
  - 快捷命令可自定义：
    * 默认快捷命令改为 pof（避免与其他工具冲突）
    * 支持通过环境变量 PF_SHORTCUT 自定义命令名称

CLI 使用示例:
  # 单条转发
  pof -m nft 3389:1.2.3.4:3389
  
  # 多条转发
  pof -m realm 3389:1.2.3.4:3389,3390:5.6.7.8:3389
  
  # TCP + UDP 同时转发
  pof -m nft --both 53:8.8.8.8:53
  
  # 静默模式（适合脚本）
  pof -m nft -q 3389:1.2.3.4:3389 && echo "success"
  
  # 删除规则
  pof -d nft 3389
  
  # 远程SSH执行
  ssh root@server "pof -m nft 3389:1.2.3.4:3389"

改进:
  - **多IP负载均衡/故障转移扩展** - 新增 3 个方案支持多IP配置：
    * iptables：使用 statistic 模块实现随机负载均衡
    * nftables：使用 numgen 模块实现随机负载均衡
    * nginx：upstream 多 server 配置，支持故障转移（backup 模式）
    * 更新方案选择界面，标注 [负载均衡] 和 [故障转移]
    * 多IP模式说明更新为支持 6 种方案
  - rinetd IPv6 支持：
    * rinetd 现在支持 IPv6 目标地址（需要 0.71+ 版本）
    * 自动检测目标 IP 类型，IPv6 使用 :: 监听，IPv4 使用 0.0.0.0 监听
    * 更新配置文件格式，支持 IPv4/IPv6 双栈
  - 备份列表优化：
    * 备份文件列表现在显示转发信息摘要
    * 显示转发方案、首个端口、规则数量、目标 IP
    * 示例: 20260117_054626 (28K) nftables :10777 等2条 -> 123.123.123.123
  - nftables 统一表名：
    * 所有 nftables 规则统一使用 inet port_forward 表
    * 移除对 ip nat 和 ip6 nat 表的兼容代码
    * 批量模式、CLI 模式、交互模式保持一致
  - 流量统计增强：
    * 更新流量统计说明文本
    * 从"仅 iptables/nftables 方案支持"改为"所有方案均支持流量统计"
    * nftables 流量统计现在正确读取 inet port_forward 表
    * 状态查看中增加 nftables 延迟检测
  - 开机自启恢复脚本重写：
    * 添加日志记录 (/var/log/port-forward-restore.log)
    * 恢复前先删除旧表，避免规则冲突
    * systemd 服务改用 network-online.target 确保网络就绪
  - 转发方案选择界面优化：
    * 多IP场景下推荐使用 iptables/nftables/HAProxy/gost/realm/nginx
  - 代码模块化注释：
    * 按 vless-all-in-one 风格重构模块注释
    * 每个功能模块添加清晰的分隔线和说明

修复:
  - **修复批量转发模式未设置开机自启的问题（重要）**
  - **修复 nftables DNAT 规则创建失败的问题（重要）**
  - 修复导入功能中重复的文件选择逻辑

--------------------------------------------------------------------------------

版本 1.0.3 (2026-01-15)
--------------------------------------------------------------------------------
新增功能:
  - 导入/导出配置功能（菜单选项8）：
    * 导出当前所有转发规则到 JSON 文件
    * 支持从备份文件导入规则
    * 导入时可选择使用 nftables/iptables/realm 方案
    * 自动收集 nftables、iptables、realm、gost、haproxy 配置
  - 开机自启自动设置：
    * 配置转发时自动创建开机恢复服务
    * nftables/iptables 规则重启后自动恢复
    * 无需手动设置，配置即生效

改进:
  - 界面优化：头部分隔线长度缩短，更紧凑
  - 启动转发服务（选项4）逻辑优化：
    * 改进配置检测，不再仅依赖 systemctl is-enabled
    * 检查配置文件存在即可启动，无需预先启用服务
    * 显示已运行的服务状态
    * 启动失败时显示错误日志
    * 支持从 netfilter-persistent 恢复 iptables 规则

修复:
  - 修复重启 VPS 后转发规则丢失的问题
  - 修复选项4启动转发服务时无法启动的问题
  - 修复卸载所有服务时未清理 nftables 规则的问题
  - 修复配置存在但无法被检测到的问题

--------------------------------------------------------------------------------

版本 1.0.2 (2026-01-13)
--------------------------------------------------------------------------------
新增功能:
>>>>>>> b37b7ee (1.0.4)
  - IPv6 地址支持：可直接输入 IPv6 地址作为转发目标
  - 除 rinetd 外，所有方案均支持 IPv6：
    * iptables (自动使用 ip6tables)
    * nftables
    * HAProxy
    * socat
    * gost
    * realm
    * nginx stream
  - 多端口配置：支持单端口、多端口、端口范围、端口映射等格式
    * 单端口: 3389
    * 多端口: 80,443,8080
    * 端口范围: 8000-8010
    * 端口映射: 33389:3389 (本地端口:目标端口)
    * 混合格式: 80,443,8000-8005,33389:3389
  - 多目标追加模式：同一转发方案可配置多个不同目标地址，规则累加不覆盖
  - 国内加速下载：内置多个 GitHub 代理镜像，自动尝试
    * ghproxy.com (优先)
    * mirror.ghproxy.com
    * gh.ddlc.top
    * github.moeyy.xyz
    * gh-proxy.com
  - 智能下载函数：wget 优先，自动切换镜像源，快速失败快速切换
  - 所有方案流量统计：用户态服务通过 iptables INPUT 链统计入站流量
  - IPv4/IPv6 双栈监听：所有方案同时监听 IPv4 和 IPv6
  - 智能本地 IP 检测：纯 IPv6 机器自动显示 IPv6 地址

改进:
  - HAProxy/gost/realm/rinetd 配置改为追加模式
  - socat 为每个端口创建独立服务，便于管理
  - 流量统计页面显示用户态服务配置详情和流量
  - 清理逻辑优化，只清理相同端口的旧规则
  - DNS64 配置改为手动确认，不再自动修改
  - 状态显示优化，realm 正确显示本地端口和目标

修复:
  - 修复纯 IPv6 机器本地地址显示错误
  - 修复 realm 状态显示缺少本地端口
  - 修复 DNS64 误触发问题

--------------------------------------------------------------------------------

版本 1.0.1 (2026-01-01)
--------------------------------------------------------------------------------
新增功能:
  - nftables DNAT 转发方案（现代 Linux 内核推荐）
  - nftables 流量统计支持

--------------------------------------------------------------------------------

版本 1.0.0
--------------------------------------------------------------------------------
  - 初始版本发布
  - 支持 7 种转发方案: iptables/HAProxy/socat/gost/realm/rinetd/nginx stream
  - 自动安装依赖和优化网络性能
  - 实时状态查看和延迟检测
  - 配置备份和恢复功能

================================================================================
