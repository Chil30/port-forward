# ğŸš€ ç«¯å£è½¬å‘ç®¡ç†å·¥å…· (Port Forward Manager)

ä¸€æ¬¾ Linux ç«¯å£è½¬å‘ç®¡ç†å·¥å…·ï¼Œæ”¯æŒ 8 ç§è½¬å‘æ–¹æ¡ˆï¼Œè‡ªåŠ¨å®‰è£…ä¾èµ–å’Œä¼˜åŒ–ç½‘ç»œæ€§èƒ½ã€‚

## ğŸ“‹ æ›´æ–°æ—¥å¿—

### v1.0.1 (2026-01-01)
- ğŸ†• æ–°å¢ nftables DNAT è½¬å‘æ–¹æ¡ˆï¼ˆç°ä»£ Linux å†…æ ¸æ¨èï¼‰

### v1.0.0
- åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- æ”¯æŒ 7 ç§è½¬å‘æ–¹æ¡ˆ

## âœ¨ ç‰¹æ€§

- ğŸ¯ **8 ç§è½¬å‘æ–¹æ¡ˆ** - nftables / iptables / HAProxy / socat / gost / realm / rinetd / nginx stream
- ğŸ”§ **è‡ªåŠ¨éƒ¨ç½²** - è‡ªåŠ¨å®‰è£…ä¾èµ–ã€é…ç½®æœåŠ¡ã€ä¼˜åŒ–å†…æ ¸
- ğŸ“Š **å®æ—¶çŠ¶æ€** - æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒè½¬å‘è§„åˆ™å’Œå»¶è¿Ÿæ£€æµ‹
- ğŸ“ˆ **æµé‡ç»Ÿè®¡** - nftables/iptables è§„åˆ™æ”¯æŒæµé‡ç»Ÿè®¡
- ğŸš„ **æ€§èƒ½ä¼˜åŒ–** - è‡ªåŠ¨å¯ç”¨ BBRã€TCP Fast Openã€å¤§ç¼“å†²åŒºç­‰ä¼˜åŒ–
- ğŸ”„ **å¤šè§„åˆ™å…±å­˜** - ä¸åŒè½¬å‘æ–¹æ¡ˆå¯åŒæ—¶è¿è¡Œï¼Œäº’ä¸å½±å“
- ğŸ’¾ **é…ç½®å¤‡ä»½** - è‡ªåŠ¨å¤‡ä»½é…ç½®ï¼Œæ”¯æŒå¿«é€Ÿæ¢å¤
- ğŸ¨ **å‹å¥½ç•Œé¢** - å½©è‰²äº¤äº’å¼èœå•ï¼Œæ“ä½œç®€å•ç›´è§‚

## ğŸ“‹ æ”¯æŒç³»ç»Ÿ

- Debian 10/11/12 âœ…
- Ubuntu 20.04/22.04/24.04 âœ…
- CentOS 7 âš ï¸ (åŸºæœ¬æ”¯æŒï¼Œä½¿ç”¨ yum)

> è„šæœ¬ä¸»è¦åœ¨ Debian/Ubuntu ä¸Šæµ‹è¯•ï¼ŒCentOS/RHEL ç³»åˆ—åŸºæœ¬å¯ç”¨ä½†éƒ¨åˆ†ä¾èµ–å¯èƒ½éœ€è¦æ‰‹åŠ¨å®‰è£…ã€‚

## ğŸ› ï¸ å®‰è£…

### ä¸€é”®å®‰è£…

```bash
bash <(curl -sL https://raw.githubusercontent.com/Chil30/port-forward/main/port_forward.sh)
```

### æ‰‹åŠ¨å®‰è£…

```bash
# ä¸‹è½½è„šæœ¬
wget https://raw.githubusercontent.com/Chil30/port-forward/main/port_forward.sh

# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x port_forward.sh

# è¿è¡Œè„šæœ¬
./port_forward.sh
```

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨å®‰è£…åˆ° `/usr/local/bin/pf`ï¼Œä¹‹åå¯ç›´æ¥ä½¿ç”¨ `pf` å‘½ä»¤ã€‚

## ğŸ“– ä½¿ç”¨æ–¹æ³•

### å¯åŠ¨å·¥å…·

```bash
pf
```

### ä¸»èœå•

```
============================================================================
                      ç«¯å£è½¬å‘ç®¡ç†å·¥å…· v1.0.1
============================================================================
  çŠ¶æ€: è¿è¡Œä¸­    è½¬å‘è§„åˆ™: 3 æ¡
  ä½œè€…: Chil30    å‘½ä»¤: pf
  é¡¹ç›®: https://github.com/Chil30/port-forward
============================================================================

  1) é…ç½®æ–°çš„ç«¯å£è½¬å‘
  2) æŸ¥çœ‹å½“å‰è½¬å‘çŠ¶æ€
  3) æŸ¥çœ‹è¿è¡Œæ—¥å¿—
  4) åœæ­¢è½¬å‘æœåŠ¡
  5) æŸ¥çœ‹å¤‡ä»½æ–‡ä»¶
  6) æµé‡ç»Ÿè®¡
  7) å¸è½½è½¬å‘æœåŠ¡
  0) é€€å‡º
```

### è½¬å‘æ–¹æ¡ˆå¯¹æ¯”

| æ–¹æ¡ˆ | å»¶è¿Ÿ | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹ |
|------|------|----------|------|
| nftables DNAT | â­ æœ€ä½ | æ¸¸æˆ/RDP/VNC | ç°ä»£å†…æ ¸çº§è½¬å‘ï¼Œæ¨è |
| iptables DNAT | â­ æœ€ä½ | æ¸¸æˆ/RDP/VNC | ä¼ ç»Ÿå†…æ ¸çº§è½¬å‘ |
| realm | â­â­ è¾ƒä½ | é«˜å¹¶å‘åœºæ™¯ | Rust ç¼–å†™ï¼Œé«˜æ€§èƒ½ |
| HAProxy | â­â­ è¾ƒä½ | Web/è´Ÿè½½å‡è¡¡ | åŠŸèƒ½ä¸°å¯Œï¼Œæ”¯æŒå¥åº·æ£€æŸ¥ |
| nginx stream | â­â­ è¾ƒä½ | Web/SSL | ä¸ç°æœ‰ nginx é›†æˆ |
| socat | â­â­ è¾ƒä½ | é€šç”¨è½¬å‘ | ç®€å•å¯é  |
| rinetd | â­â­ è¾ƒä½ | å¤šç«¯å£è½¬å‘ | é…ç½®ç®€å• |
| gost | â­â­â­ ä¸­ç­‰ | åŠ å¯†ä»£ç† | æ”¯æŒå¤šåè®®ã€åŠ å¯† |

**æ€§èƒ½æ’åº**: nftables/iptables > realm > HAProxy/nginx > socat/rinetd > gost

**åŠŸèƒ½æ’åº**: gost > nginx/HAProxy > realm > socat/rinetd > nftables/iptables

### é…ç½®ç¤ºä¾‹

1. è¿è¡Œ `pf` è¿›å…¥ä¸»èœå•
2. é€‰æ‹© `1) é…ç½®æ–°çš„ç«¯å£è½¬å‘`
3. è¾“å…¥ç›®æ ‡æœåŠ¡å™¨ IP å’Œç«¯å£
4. è¾“å…¥æœ¬åœ°ç›‘å¬ç«¯å£
5. é€‰æ‹©è½¬å‘æ–¹æ¡ˆ
6. ç¡®è®¤é…ç½®å¼€å§‹éƒ¨ç½²

```
ç›®æ ‡æœåŠ¡å™¨IP/åŸŸå: 192.168.1.100
ç›®æ ‡ç«¯å£ [3389]: 22
æœ¬åœ°ç›‘å¬ç«¯å£ [22]: 33389
è¯·é€‰æ‹©æ–¹æ¡ˆ [1]: 5

é…ç½®ç¡®è®¤ï¼š
ç›®æ ‡æœåŠ¡å™¨: 192.168.1.100:22
æœ¬åœ°ç›‘å¬: 0.0.0.0:33389
è½¬å‘æ–¹æ¡ˆ: realm

ç¡®è®¤é…ç½®å¹¶å¼€å§‹éƒ¨ç½²? [Y/n]: y
```

## ğŸ”§ æ€§èƒ½ä¼˜åŒ–

è„šæœ¬ä¼šè‡ªåŠ¨åº”ç”¨ä»¥ä¸‹å†…æ ¸ä¼˜åŒ–ï¼š

- âœ… BBR æ‹¥å¡æ§åˆ¶ç®—æ³•
- âœ… TCP Fast Open (å‡å°‘æ¡æ‰‹å»¶è¿Ÿ)
- âœ… 256MB ç½‘ç»œç¼“å†²åŒº
- âœ… æ—©æœŸé‡ä¼ æœºåˆ¶
- âœ… ç˜¦æµä¼˜åŒ–
- âœ… ç¦ç”¨å»¶è¿Ÿ ACK
- âœ… è¿æ¥è·Ÿè¸ªä¼˜åŒ–

## ğŸ“ æ–‡ä»¶ä½ç½®

| æ–‡ä»¶ | è·¯å¾„ |
|------|------|
| è„šæœ¬å‘½ä»¤ | `/usr/local/bin/pf` |
| é…ç½®å¤‡ä»½ | `/root/.port_forward_backups/` |
| nftables å¤‡ä»½ | `/root/.port_forward_nftables_running.txt` |
| nftables é…ç½® | `/etc/nftables.d/port_forward.nft` |
| iptables å¤‡ä»½ | `/root/.port_forward_iptables_running.txt` |
| realm é…ç½® | `/etc/realm/config.toml` |
| gost é…ç½® | `/etc/gost/config.json` |
| HAProxy é…ç½® | `/etc/haproxy/haproxy.cfg` |
| rinetd é…ç½® | `/etc/rinetd.conf` |
| nginx stream | `/etc/nginx/stream.d/port-forward-*.conf` |

## â“ å¸¸è§é—®é¢˜

### Q: nftables å’Œ iptables æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

A: nftables æ˜¯ iptables çš„ç°ä»£æ›¿ä»£å“ï¼Œåœ¨è¾ƒæ–°çš„ Linux å†…æ ¸ï¼ˆ3.13+ï¼‰ä¸­æ¨èä½¿ç”¨ã€‚ä¸¤è€…æ€§èƒ½ç›¸è¿‘ï¼Œä½† nftables è¯­æ³•æ›´ç®€æ´ã€åŠŸèƒ½æ›´å¼ºå¤§ã€‚å¦‚æœç³»ç»Ÿé»˜è®¤ä½¿ç”¨ nftablesï¼ˆå¦‚ Debian 10+ï¼‰ï¼Œå»ºè®®é€‰æ‹© nftables æ–¹æ¡ˆã€‚

### Q: nftables/iptables è§„åˆ™é‡å¯åä¸¢å¤±ï¼Ÿ

A: è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½è§„åˆ™ï¼Œå¯é€šè¿‡èœå• `4) å¯åŠ¨è½¬å‘æœåŠ¡` æ¢å¤ã€‚

nftables æŒä¹…åŒ–ï¼š
```bash
# è§„åˆ™ä¼šä¿å­˜åˆ° /etc/nftables.d/port_forward.nft
systemctl enable nftables
```

iptables æŒä¹…åŒ–ï¼š
```bash
apt install iptables-persistent
netfilter-persistent save
```

### Q: iptables è§„åˆ™é‡å¯åä¸¢å¤±ï¼Ÿ

A: è„šæœ¬ä¼šè‡ªåŠ¨å¤‡ä»½ iptables è§„åˆ™åˆ° `/root/.port_forward_iptables_running.txt`ï¼Œå¯é€šè¿‡èœå• `4) å¯åŠ¨è½¬å‘æœåŠ¡` æ¢å¤ã€‚å»ºè®®å®‰è£… `iptables-persistent` å®ç°æŒä¹…åŒ–ï¼š

```bash
apt install iptables-persistent
netfilter-persistent save
```

### Q: nginx stream æŠ¥é”™ "unknown directive stream"ï¼Ÿ

A: Debian/Ubuntu é»˜è®¤çš„ nginx åŒ…ä¸åŒ…å« stream æ¨¡å—ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å®‰è£… `nginx-full` å¹¶åŠ è½½æ¨¡å—ã€‚å¦‚æœå·²æœ‰ nginx è¿è¡Œï¼Œè„šæœ¬ä¼šä¿ç•™ç°æœ‰é…ç½®ï¼Œåªæ·»åŠ  stream è½¬å‘ã€‚

### Q: å¦‚ä½•åŒæ—¶ä½¿ç”¨å¤šç§è½¬å‘æ–¹æ¡ˆï¼Ÿ

A: è„šæœ¬æ”¯æŒå¤šç§æ–¹æ¡ˆå…±å­˜ã€‚éƒ¨ç½²æ–°æ–¹æ¡ˆæ—¶åªä¼šæ¸…ç†åŒç±»å‹çš„æ—§é…ç½®ï¼Œä¸å½±å“å…¶ä»–æ–¹æ¡ˆã€‚ä¾‹å¦‚å¯ä»¥åŒæ—¶è¿è¡Œ iptables è½¬å‘ç«¯å£ A å’Œ realm è½¬å‘ç«¯å£ Bã€‚

### Q: rinetd ç«¯å£ç›‘å¬å¤±è´¥ï¼Ÿ

A: ç¡®ä¿ç«¯å£æœªè¢«å ç”¨ï¼Œè„šæœ¬ä¼šè‡ªåŠ¨å¤„ç† rinetd æœåŠ¡é‡å¯ã€‚å¦‚ä»æœ‰é—®é¢˜ï¼Œå°è¯•ï¼š

```bash
killall rinetd
systemctl restart rinetd
```

### Q: å¦‚ä½•æŸ¥çœ‹è½¬å‘æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ

A: 
1. ä½¿ç”¨èœå• `2) æŸ¥çœ‹å½“å‰è½¬å‘çŠ¶æ€` æŸ¥çœ‹æ‰€æœ‰æ´»è·ƒè§„åˆ™å’Œå»¶è¿Ÿ
2. ä½¿ç”¨ `telnet æœ¬æœºIP æœ¬åœ°ç«¯å£` æµ‹è¯•è¿æ¥
3. ä½¿ç”¨ `ss -tlnp` æŸ¥çœ‹ç«¯å£ç›‘å¬çŠ¶æ€

### Q: å¦‚ä½•å®Œå…¨å¸è½½ï¼Ÿ

A: ä½¿ç”¨èœå• `7) å¸è½½è½¬å‘æœåŠ¡`ï¼Œé€‰æ‹© `9) å¸è½½æ‰€æœ‰æœåŠ¡`ã€‚è¿™ä¼šåœæ­¢æ‰€æœ‰æœåŠ¡ã€æ¸…ç†é…ç½®æ–‡ä»¶å’Œé˜²ç«å¢™è§„åˆ™ã€‚

### Q: è½¬å‘å»¶è¿Ÿå¾ˆé«˜æ€ä¹ˆåŠï¼Ÿ

A: 
1. ä¼˜å…ˆä½¿ç”¨ iptables DNAT æ–¹æ¡ˆï¼ˆå†…æ ¸çº§ï¼Œå»¶è¿Ÿæœ€ä½ï¼‰
2. ç¡®è®¤ BBR å·²å¯ç”¨ï¼š`sysctl net.ipv4.tcp_congestion_control`
3. æ£€æŸ¥ç›®æ ‡æœåŠ¡å™¨ç½‘ç»œè´¨é‡

## ğŸ”— ç›¸å…³é“¾æ¥

- GitHub: https://github.com/Chil30/port-forward
- Issues: https://github.com/Chil30/port-forward/issues

## ğŸ“„ è®¸å¯è¯

MIT License

## ğŸ™ è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- [realm](https://github.com/zhboner/realm)
- [gost](https://github.com/ginuerzh/gost)
- [HAProxy](https://www.haproxy.org/)
- [nginx](https://nginx.org/)
